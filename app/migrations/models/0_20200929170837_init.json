{
  "upgrade": [
    "CREATE TABLE IF NOT EXISTS \"eva_idp\" (\n    \"created_at\" TIMESTAMP NOT NULL  DEFAULT CURRENT_TIMESTAMP,\n    \"updated_at\" TIMESTAMP NOT NULL  DEFAULT CURRENT_TIMESTAMP,\n    \"id\" BIGSERIAL NOT NULL PRIMARY KEY,\n    \"name\" VARCHAR(32) NOT NULL,\n    \"type\" VARCHAR(8) NOT NULL,\n    \"config\" JSONB,\n    \"is_active\" BOOL NOT NULL  DEFAULT False\n);\nCOMMENT ON COLUMN \"eva_idp\".\"type\" IS 'IdP类型';\nCOMMENT ON COLUMN \"eva_idp\".\"config\" IS '该IdP的详细配置';\nCOMMENT ON COLUMN \"eva_idp\".\"is_active\" IS '该IdP是否启用？';\nCOMMENT ON TABLE \"eva_idp\" IS 'IdP';\nCREATE TABLE IF NOT EXISTS \"eva_identity\" (\n    \"created_at\" TIMESTAMP NOT NULL  DEFAULT CURRENT_TIMESTAMP,\n    \"updated_at\" TIMESTAMP NOT NULL  DEFAULT CURRENT_TIMESTAMP,\n    \"id\" BIGSERIAL NOT NULL PRIMARY KEY,\n    \"uuid\" UUID NOT NULL UNIQUE,\n    \"is_active\" BOOL NOT NULL  DEFAULT True\n);\nCOMMENT ON TABLE \"eva_identity\" IS '用户 ';\nCREATE TABLE IF NOT EXISTS \"eva_credential\" (\n    \"created_at\" TIMESTAMP NOT NULL  DEFAULT CURRENT_TIMESTAMP,\n    \"updated_at\" TIMESTAMP NOT NULL  DEFAULT CURRENT_TIMESTAMP,\n    \"id\" BIGSERIAL NOT NULL PRIMARY KEY,\n    \"identifier\" VARCHAR(64) NOT NULL,\n    \"identifier_type\" VARCHAR(8) NOT NULL,\n    \"identity_id\" BIGINT NOT NULL REFERENCES \"eva_identity\" (\"id\") ON DELETE CASCADE,\n    \"idp_id\" BIGINT REFERENCES \"eva_idp\" (\"id\") ON DELETE CASCADE,\n    CONSTRAINT \"uid_eva_credent_identit_4dc08b\" UNIQUE (\"identity_id\", \"identifier\")\n);\nCOMMENT ON COLUMN \"eva_credential\".\"identifier\" IS '凭证唯一标识，如：邮件地址,手机号,微信openid等';\nCOMMENT ON COLUMN \"eva_credential\".\"identifier_type\" IS 'identifier 的类型，如用户名只能对应密码认证；邮件和手机号可以有其对应的验证码认证';\nCOMMENT ON TABLE \"eva_credential\" IS '凭证';\nCREATE TABLE IF NOT EXISTS \"eva_password\" (\n    \"created_at\" TIMESTAMP NOT NULL  DEFAULT CURRENT_TIMESTAMP,\n    \"updated_at\" TIMESTAMP NOT NULL  DEFAULT CURRENT_TIMESTAMP,\n    \"id\" BIGSERIAL NOT NULL PRIMARY KEY,\n    \"shadow\" VARCHAR(512) NOT NULL,\n    \"expires_at\" TIMESTAMP,\n    \"credential_id\" BIGINT NOT NULL REFERENCES \"eva_credential\" (\"id\") ON DELETE CASCADE\n);\nCOMMENT ON TABLE \"eva_password\" IS '密码验证方式';\nCREATE TABLE IF NOT EXISTS \"eva_permission\" (\n    \"created_at\" TIMESTAMP NOT NULL  DEFAULT CURRENT_TIMESTAMP,\n    \"updated_at\" TIMESTAMP NOT NULL  DEFAULT CURRENT_TIMESTAMP,\n    \"id\" BIGSERIAL NOT NULL PRIMARY KEY,\n    \"code\" VARCHAR(128) NOT NULL UNIQUE,\n    \"name\" VARCHAR(128) NOT NULL UNIQUE,\n    \"description\" TEXT\n);\nCOMMENT ON TABLE \"eva_permission\" IS '提供“标识“，判断用户是否拥有某个“权限”';\nCREATE TABLE IF NOT EXISTS \"eva_role\" (\n    \"created_at\" TIMESTAMP NOT NULL  DEFAULT CURRENT_TIMESTAMP,\n    \"updated_at\" TIMESTAMP NOT NULL  DEFAULT CURRENT_TIMESTAMP,\n    \"id\" BIGSERIAL NOT NULL PRIMARY KEY,\n    \"code\" VARCHAR(128) NOT NULL UNIQUE,\n    \"name\" VARCHAR(128) NOT NULL,\n    \"description\" TEXT\n);\nCOMMENT ON TABLE \"eva_role\" IS '角色与一组权限绑定，用户可以属于多个角色。';\nCREATE TABLE IF NOT EXISTS \"eva_security_code\" (\n    \"created_at\" TIMESTAMP NOT NULL  DEFAULT CURRENT_TIMESTAMP,\n    \"updated_at\" TIMESTAMP NOT NULL  DEFAULT CURRENT_TIMESTAMP,\n    \"id\" BIGSERIAL NOT NULL PRIMARY KEY,\n    \"expires_at\" TIMESTAMP NOT NULL,\n    \"credential_id\" BIGINT NOT NULL REFERENCES \"eva_credential\" (\"id\") ON DELETE CASCADE\n);\nCOMMENT ON TABLE \"eva_security_code\" IS '验证码验证方式';\nCREATE TABLE IF NOT EXISTS \"aerich\" (\n    \"id\" SERIAL NOT NULL PRIMARY KEY,\n    \"version\" VARCHAR(255) NOT NULL,\n    \"app\" VARCHAR(20) NOT NULL\n);\nCREATE TABLE IF NOT EXISTS \"eva_identity_eva_role\" (\n    \"eva_identity_id\" BIGINT NOT NULL REFERENCES \"eva_identity\" (\"id\") ON DELETE CASCADE,\n    \"role_id\" BIGINT NOT NULL REFERENCES \"eva_role\" (\"id\") ON DELETE CASCADE\n);\nCREATE TABLE IF NOT EXISTS \"eva_role_eva_permission\" (\n    \"eva_role_id\" BIGINT NOT NULL REFERENCES \"eva_role\" (\"id\") ON DELETE CASCADE,\n    \"permission_id\" BIGINT NOT NULL REFERENCES \"eva_permission\" (\"id\") ON DELETE CASCADE\n);"
  ]
}
